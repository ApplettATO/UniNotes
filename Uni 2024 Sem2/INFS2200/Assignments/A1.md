```
--Question 1:

ALTER TABLE EVENTS ADD CONSTRAINT CK_EVENT_TYPE

    CHECK (event_type IN ('Loan', 'Return', 'Hold', 'Loss'));

  

--Question 2.1

    -- How do i end this trigger, is checking the right thing to do?

CREATE OR REPLACE FUNCTION UDF_BI_GUARDIAN()

RETURNS TRIGGER AS $$

BEGIN

    IF ((CURRENT_DATE - PATRONS.dob)/365) < 18 THEN

        CHECK (NEW.guardian IS NOT NULL)

    RETURN NEW;

END;

-- do i need to include this

$$ LANGUAGE plpgsql;

  

CREATE TRIGGER BI_GUARDIAN

BEFORE INSERT ON PATRONS

FOR EACH ROW

EXECUTE FUNCTION UDF_BI_GUARDIAN();

  

--Question 2.2

CREATE OR REPLACE FUNCTION UUDF_BI_EMAIL_ADDR()

RETURNS TRIGGER AS $$

BEGIN

    IF ((CURRENT_DATE - PATRONS.dob)/365) >= 18 THEN

        CHECK (NEW.email_address IS NOT NULL)

    RETURN NEW;

END;

-- wa

$$ LANGUAGE plpgsql;

  

CREATE TRIGGER BI_EMAIL_ADDR

BEFORE INSERT ON PATRONS

FOR EACH ROW

EXECUTE FUNCTION UDF_BI_EMAIL_ADDR();

  

--Question 3.1

CREATE SEQUENCE ITEM_ID_SEQ

MINVALUE 1000000000

MAXVALUE 9999999999

INCREMENT BY 1

START WITH 1000000000;

  

--Question 3.2

CREATE OR REPLACE FUNCTION UDF_BI_ITEM_ID()

RETURNS TRIGGER AS $$

BEGIN

    -- need to check if null before adding to list?

    NEW.item_id := NEXTVAL('ITEM_ID_SEQ');

    RETURN NEW;

END;

$$ LANGUAGE plpgsql;

  

CREATE TRIGGER BI_ITEM_ID

BEFORE INSERT ON ITEMS

FOR EACH ROW

EXECUTE FUNCTION UDF_BI_ITEM_ID();

  

--Question 3.3

SELECT

    c.relname AS sequence_name,

    t.relname AS table_name,

    a.attname AS column_name

FROM

    pg_class c

JOIN

    pg_namespace n ON n.oid = c.relnamespace

JOIN

    pg_depend d ON d.objid = c.oid

JOIN

    pg_class t ON t.oid = d.refobjid

JOIN

    pg_attribute a ON a.attrelid = t.oid AND a.attnum = d.refobjsubid

WHERE

    c.relkind = 'S' -- 'S' stands for sequence

    AND t.relname IN ('PATRONS', 'EVENTS');
```